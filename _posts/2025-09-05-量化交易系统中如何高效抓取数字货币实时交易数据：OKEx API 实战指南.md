---
layout:     post
title:      é‡åŒ–äº¤æ˜“ç³»ç»Ÿä¸­å¦‚ä½•é«˜æ•ˆæŠ“å–æ•°å­—è´§å¸å®æ—¶äº¤æ˜“æ•°æ®ï¼šOKEx API å®æˆ˜æŒ‡å—
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

> å…³é”®è¯ï¼šé‡åŒ–äº¤æ˜“ã€æ•°å­—è´§å¸äº¤æ˜“æ•°æ®ã€å®æ—¶è¡Œæƒ…ã€è‡ªåŠ¨åŒ–äº¤æ˜“ã€OKEx APIã€WebSocket é«˜é¢‘ã€ REST APIã€äº¤æ˜“ Tickã€å¸‚åœºæƒ…ç»ª

## 1. å›é¡¾ï¼šä¸ºä»€ä¹ˆâ€œäº¤æ˜“æ•°æ®â€æ˜¯é‡åŒ–ç³»ç»Ÿçš„å‘½è„‰
åœ¨**é‡åŒ–äº¤æ˜“ç³»ç»Ÿå¼€å‘**çš„ç¯èŠ‚é‡Œï¼Œ**æ•°å­—è´§å¸äº¤æ˜“æ•°æ®ï¼ˆTrade Tickï¼‰** çš„ä»·å€¼å¸¸è¢«ä½ä¼°ã€‚ä¸€æ¡çœ‹ä¼¼å•è°ƒçš„æˆäº¤è®°å½•ï¼Œå…¶å®éšè—ç€å¸‚åœºæƒ…ç»ªã€ä¸»åŠ›æµåŠ¨ã€å†°å±±å•è¸ªè¿¹ç­‰é«˜ä»·å€¼ä¿¡æ¯ã€‚  
- å¯¹äºæ—¥å†…å›è½¬æˆ–**é«˜é¢‘ç­–ç•¥**ï¼Œæ¯«ç§’çº§çš„**å®æ—¶è¡Œæƒ…**å†³å®šäº†æ»‘ç‚¹åšåº¦ä¸æˆäº¤æ¦‚ç‡ï¼›  
- å¯¹äºé‡åŒ–æ‹©æ—¶æˆ–å®è§‚å¯¹å†²ï¼Œåƒçº§è‡³ä¸‡çº§å†å² Tick åˆèƒ½é‡å¡‘æ•´ä¸ªæ”¶ç›Šç‡æ›²çº¿ã€‚  

ğŸ‘‰ [æƒ³äº†è§£å¦‚ä½•ç”¨æœ€å°‘ä»£ç æŠŠ 10 ä¸‡æ¡ Tick æ•°æ®â€œæ¸…æ´—â€æˆè¶…é¢æ”¶ç›Šå› å­ï¼Ÿç‚¹è¿™é‡Œçœ‹çœ‹å®æˆ˜æ¡ˆä¾‹ã€‚](https://okxdog.com/)

æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ¼”ç¤ºï¼š  
- åˆ©ç”¨ **OKEx APIï¼ˆREST + WebSocketï¼‰** è·å–å¹¶å­˜å‚¨æµ·é‡ Tickï¼›  
- æŠŠâ€œæ•°æ®æµâ€å‡çº§ä¸ºâ€œèµ„é‡‘æµâ€çš„å®Œæ•´å‘å¸ƒâ€”è®¢é˜…â€”å­˜æ¡£æµç¨‹ï¼›  
- å·¥ç¨‹åŒ–ä¸­ç»å¸¸è¢«å¿½ç•¥çš„æ€§èƒ½å‘ä¸åˆè§„æ³¨æ„äº‹é¡¹ã€‚

---

## 2. API è·å–å§¿åŠ¿æ€»è§ˆï¼šREST vs WebSocket
| ç»´åº¦ | REST API | WebSocket API |
|---|---|---|
| åœºæ™¯ | **å†å²äº¤æ˜“æ•°æ®**ã€æ‰¹é‡ä¸‹è½½å›æµ‹ | **å®æ—¶è¡Œæƒ…**ã€æ¯«ç§’çº§è®¢é˜… |
| å»¶è¿Ÿ | ç§’çº§ï¼ˆå—è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼‰ | å°äº 50 ms |
| è¯·æ±‚æ–¹å¼ | HTTP GET | åŒå‘é€šä¿¡ |
| Python ç¤ºä¾‹ä¾èµ– | `requests` | `websockets` / `aiohttp` |

> å®è·µæç¤ºï¼š**å…ˆæŠŠ REST è·å–å†å²æ•°æ®åšæˆâ€œå†·å¯åŠ¨â€è„šæœ¬ï¼Œå†ç”¨ WebSocket åšâ€œå¢é‡â€è¡¥æµ**ï¼Œ99 % çš„å›¢é˜Ÿéƒ½æ­»åœ¨è¿™ä¸€æ­¥ã€‚

---

## 3. äº”åˆ†é’Ÿå®Œæˆå‰æœŸå‡†å¤‡
1. **æ³¨å†Œå¹¶ç™»å½• OKExï¼ˆæˆ–æ¬§æ˜“æ–°å“ç‰Œåï¼‰**ï¼Œè¿›å…¥â€œAPI ç®¡ç†â€æ–°å»ºå¯†é’¥ã€‚  
   - æƒé™è‡³å°‘å‹¾é€‰ã€Œè¯»å–ã€ï¼Œåˆ‡å‹¿æ”¾å‡ºã€Œæå¸ã€ã€‚  
   - è®°å½• `API Key / Secret / Passphrase`ï¼Œåé¢ç­¾åè¦ç”¨ã€‚  
2. **å®‰è£… Python ç¯å¢ƒä¾èµ–**  
   ```bash
   pip install requests websockets
   ```
3. **åœ¨ä»£ç æ ¹ç›®å½•å»ºç«‹ `.env` æ–‡ä»¶**ï¼ˆé˜²æ­¢ç¡¬ç¼–ç æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼‰  
   ```
   OKEX_API_KEY=xxxxxxxx
   OKEX_SECRET=yyyyyyyy
   OKEX_PASSPHRASE=zzzzzz
   ```

---

## 4. REST APIï¼šä¸€æ¬¡æ€§æ‹‰å–å†å²äº¤æ˜“æ•°æ®
### 4.1 æ ¸å¿ƒæ¥å£è·¯å¾„  
```
GET /api/v5/market/trades
```
è¯·æ±‚å‚æ•°ä¸­è‡³å°‘ç»™å‡ºï¼š
- `instId`ï¼šå¦‚ BTC-USDT  
- `limit`ï¼šé»˜è®¤ 100ï¼Œæœ€å¤§ 500  

### 4.2 ä»£ç ç¤ºä¾‹ï¼ˆå«å…¨é‡åˆ†é¡µï¼‰
```python
import time, os, requests, hmac, hashlib, base64

def sign(ts, method, path, body=""):
    msg = f"{ts}{method.upper()}{path}{body}".encode()
    mac = hmac.new(os.getenv("OKEX_SECRET").encode(), msg, hashlib.sha256).digest()
    return base64.b64encode(mac).decode()

def fetch_trades_rest(inst_id, limit=500):
    url = "https://www.okx.com"
    path = f"/api/v5/market/trades?instId={inst_id}&limit={limit}"
    ts = str(time.time())
    headers = {
        "OK-ACCESS-KEY": os.getenv("OKEX_API_KEY"),
        "OK-ACCESS-SIGN": sign(ts, "GET", path),
        "OK-ACCESS-TIMESTAMP": ts,
        "OK-ACCESS-PASSPHRASE": os.getenv("OKEX_PASSPHRASE"),
        "Content-Type": "application/json"
    }
    res = requests.get(url + path, headers=headers).json()
    return res["data"]
```

> æŠ€å·§ï¼šè®¾ç½® `limit=500` æ¯æ¬¡æ‹‰å–ï¼Œå¾ªç¯è¯·æ±‚ç›´åˆ° `data` ä¸ºç©ºï¼Œå†é…åˆæ—¶é—´æˆ³çª—å£ï¼ˆå¦‚ 6 å°æ—¶ï¼‰å³å¯å®ç°ç™¾ä¸‡çº§æ•°æ®è¡¥å½•ã€‚

---

## 5. WebSocket APIï¼šå®æ—¶è®¢é˜…æœ€æ–°æˆäº¤
### 5.1 å»ºç«‹è¿æ¥ä¸è®¢é˜…é¢‘é“
- åŸŸåï¼š`wss://ws.okx.com/v5/public`
- é¢‘é“ï¼š`trades`ï¼ˆæ— éœ€ç™»å½•ï¼‰

### 5.2 æ ¸å¿ƒä»£ç ç‰‡æ®µï¼ˆå¼‚æ­¥ç‰ˆï¼‰
```python
import asyncio, json, websockets

async def trades_stream(inst_id):
    url = "wss://ws.okx.com/v5/public"
    sub = {
        "op": "subscribe",
        "args": [{"channel":"trades","instId":inst_id}]
    }
    async with websockets.connect(url) as ws:
        await ws.send(json.dumps(sub))
        while True:
            resp = json.loads(await ws.recv())
            if "event" not in resp:  # è¿‡æ»¤å¿ƒè·³
                for tick in resp["data"]:
                    save_to_db(tick)

if __name__ == "__main__":
    asyncio.run(trades_stream("BTC-USDT"))
```
### 5.3 æ½®æ±å†™åº“æŠ€å·§
- CSV â†’ **Parquet**ï¼šç£ç›˜å ç”¨é™ 80 %  
- å•æœºå†™å…¥ç“¶é¢ˆæ—¶ï¼Œä½¿ç”¨ `asyncio.Queue` + ä¸¤é˜¶æ®µæ‰¹é‡ commitï¼Œå°† **ç°è´§é«˜é¢‘äº¤æ˜“** æ—¶å»¶æ‹‰ä½è‡³ 3 msã€‚

---

## 6. å®æˆ˜æ¡ˆä¾‹å¤ç›˜ï¼šæŠŠ 3 å¤© Ticks æ‹æˆå¸‚åœºæƒ…ç»ªæŒ‡é’ˆ
æŸç­–ç•¥å›¢é˜Ÿæ•è·äº† 2025/3/15â€“3/17 BTC-**æ•°å­—è´§å¸äº¤æ˜“æ•°æ®**ï¼Œå…±è®¡ 1,872 ä¸‡æ¡ Tickã€‚ç»è¿‡ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆã€Œå·¨é‡å˜åŠ¨å› å­ã€ï¼š

1. **æ¸…æ´—**ï¼šå»é‡ã€åŒæ­¥äº¤æ˜“æ‰€æ—¶é—´ã€è¡¥ç¼ºå¤±æ¯«ç§’æˆ³ã€‚  
2. **èšåˆ**ï¼š60 ç§’ã€5 åˆ†é’Ÿã€1 å°æ—¶ä¸‰æ¡æ²³æµå¼æ—¶é—´ç²’åº¦ã€‚  
3. **å»ºæ¨¡**ï¼šç”¨æˆäº¤é‡æ–¹å‘æ¦‚ç‡ä¸ä»·æ ¼å¼¹æ€§ï¼Œæ„å»º **D_Volume Shock** æŒ‡æ ‡ã€‚  
4. **å®ç›˜**ï¼š2025/3/18â€“22 å¤åˆå¹´åŒ– 72 %ï¼Œå•ç¬”æ»‘ç‚¹ < 1.2 bpsï¼Œå¤§å¹…ä¼˜äºç›´æ¥ä¸‹å•ã€‚  

ğŸ‘‰ [æƒ³æ‹¿åˆ°å®Œæ•´ Python Notebookï¼Ÿæˆ³æ­¤ä¸‹è½½å¯å¤ç°ä»£ç æ¨¡æ¿ï¼ˆæ— å¹¿å‘Šç‰ˆï¼‰ã€‚](https://okxdog.com/)

---

## 7. æ€§èƒ½ä¸åˆè§„æ³¨æ„äº‹é¡¹é€ŸæŸ¥è¡¨
- **é™é€Ÿ**ï¼šREST ç°è´§è¡Œæƒ… 20 æ¬¡ / 2 sï¼›WebSocket å•è¿æ¥ä¸Šé™ 300 é¢‘é“ã€‚  
- **å­˜å‚¨**ï¼šParquet + S3 å†·å­˜ï¼ŒHFT ç°åœºç”¨ Redis Stream å½“ 100 ms L2 bufferã€‚  
- **æ—¥å¿—**ï¼šå¯¹ `instId`ã€`side`ã€`sz`ã€`px` å››å­—æ®µåŠ å¯†æ‰“æ ‡ç­¾ï¼Œæ»¡è¶³å½“åœ°ç›‘ç®¡ KYC/AML æ¡†æ¶ã€‚  

---

## 8. FAQï¼šå¼€å‘è€…æœ€å¸¸è¢«é—®çš„ 4 ä¸ªé—®é¢˜

**Q1ï¼šWebSocket ç»å¸¸è‡ªåŠ¨æ–­å¼€æ€ä¹ˆåŠï¼Ÿ**  
Aï¼šéƒ¨ç½²äº‘ç«¯å¿ƒè·³æ£€æµ‹ï¼Œæ¯ 28 ç§’å‘ä¸€æ¬¡ `{"op":"ping"}`ï¼›å†åœ¨æ–­çº¿ `on_close` ä¸­é‡è¿å³å¯ã€‚

**Q2ï¼šå•æ—¥ Tick ä½“ç§¯æœ‰å¤šå¤§ï¼Ÿ**  
Aï¼šBTC/ETH ç­‰å¤§å¸‚å€¼å¸ç§ï¼Œ**24 h** Tick æ•°çº¦ 450â€“600 ä¸‡æ¡ï¼›ä»¥ JSON æ–‡æœ¬ä¿å­˜ â‰ˆ 1.2 GBï¼Œå¯å‹ç¼©åˆ° 150 MB Parquetã€‚

**Q3ï¼šREST è·å–å†å²æ•°æ®ä¼šé—æ¼å—ï¼Ÿ**  
Aï¼šä¸ä¼šã€‚ä½†ç”±äºåˆ†é¡µå‘å‰å›æº¯ï¼Œéœ€ç”¨ `after` æ¸¸æ ‡å‚æ•°ã€‚å»ºè®®ä»å½“å‰æ—¶é—´å‘å‰æ»šåŠ¨ï¼Œä¸è¦è·³è·ƒæŸ¥è¯¢ã€‚

**Q4ï¼šå¦‚ä½•é€šè¿‡äº¤æ˜“æ•°æ®åˆ¤æ–­â€œä¸»åŠ›æ‹‰ç›˜â€ï¼Ÿ**  
Aï¼šè§‚å¯Ÿ **è¿ç»­ 3 ç¬”åŠä»¥ä¸Šè¶…å¤§ä¹°å•æˆäº¤ä¸”é‡èƒ½éª¤å‡**ã€**ä»·å·®æ‰“ç ´å‰ 5 æ—¥åˆ†ä½**ï¼Œå†ç»“åˆ **é™ä»·å¢™æŒ‚å•ç°¿** äº¤å‰éªŒè¯å³å¯ã€‚

---

## 9. å°ç»“ä¸ä¸‹ä¸€æ­¥é¢„å‘Š
åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯ä»¥ï¼š
- åˆ©ç”¨ OKEx REST API å¿«é€Ÿè¡¥å½•å›æµ‹æ•°æ®ï¼›  
- ç”¨ **WebSocket** åšåˆ°é‡äº§çº§æ¯«ç§’è®¢é˜…ï¼›  
- å°†ã€Œæ•°æ® â†’ ç‰¹å¾ â†’ ç­–ç•¥ â†’ å®ç›˜ã€å½¢æˆé—­ç¯ã€‚  

ä¸‹ä¸€æ­¥ç³»åˆ—å°†åˆ†äº« **Level 2 è®¢å•ç°¿è¿˜åŸä¸â€œæ’¤å•å¼ºåº¦â€å»ºæ¨¡**ï¼ŒæŠŠå™ªå£°æ•°æ®å†æ´—å‡ºä¸€å—é‡‘å­ã€‚å¦‚æœä½ ä¹Ÿåœ¨åš **è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿ**ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºæˆ–ç§ä¿¡æŠ€æœ¯ç»†èŠ‚äº¤æµã€‚