---
layout:     post
title:      web3py å®ç° ETH ä»¥å¤ªåŠæ‰¹é‡è½¬è´¦å®Œæ•´å®æˆ˜æ•™ç¨‹
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

> ä¸€æ¬¡å†™ 3 æ¡é“¾ä¸Šè½¬è´¦ã€5 åˆ†é’Ÿå®Œæˆéƒ¨ç½²ï¼Œå½»åº•å‘Šåˆ«é€ç¬”æ“ä½œå¸¦æ¥çš„æ•ˆç‡ç„¦è™‘ã€‚

æ‰¹é‡è½¬è´¦ï¼ˆbatch transferï¼‰æ˜¯ä»¥å¤ªåŠé’±åŒ…ã€å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€å’Œç©ºæŠ•è„šæœ¬ä¸­å¸¸è§çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æœ¬æ–‡åŸºäº **web3py** å®æˆ˜æ¼”ç¤ºï¼šå¦‚ä½•ç”¨ 1 æ®µè„šæœ¬ã€1 æ®µä»£ç ï¼ŒæŠŠ ETH åŒæ—¶å‘ç»™ä»»æ„æ•°é‡çš„æ¥æ”¶åœ°å€ï¼Œ**gas ä¼˜åŒ–å®æµ‹èŠ‚çº¦ 30% ä»¥ä¸Š**ï¼Œæœ‰æ•ˆé¿å…äº†ã€Œä¸€æ¡äº¤æ˜“ã€ä¸€æ¬¡æ‰‹ç»­è´¹ã€çš„é‡å¤æ”¯å‡ºã€‚

## åº”ç”¨åœºæ™¯ï¼šä¸ºä»€ä¹ˆä¸€å®šè¦ä¼šæ‰¹é‡è½¬è´¦ï¼Ÿ

- **ç©ºæŠ•**ï¼šä¸€æ¬¡æ€§ç»™ 1,000 ä¸ªåœ°å€æ‰“å°‘é‡ ETHã€‚  
- **å·¥èµ„/åˆ†æˆ**ï¼šé¡¹ç›®/DAO å‘å¤šä½è´¡çŒ®è€…å®šæœŸæ‰“æ¬¾ã€‚  
- **æ‰‹ç»­è´¹ä»£ä»˜**ï¼šDApp å†…ç½®ä¸­ç»§å™¨ï¼Œä¸ºç”¨æˆ·ä»£ä»˜ gas æ—¶æå‰æŠŠ ETH æ‰“åˆ°å¤šåœ°å€ã€‚  

å…³é”®è¯ï¼š**ä»¥å¤ªåŠæ‰¹é‡è½¬è´¦ã€web3py æ•™ç¨‹ã€ETH åˆå•ä»˜æ¬¾ã€gas ä¼˜åŒ–ã€ropsten æµ‹è¯•**ã€‚

---

## ç¯å¢ƒé€Ÿè§ˆï¼šä¸€åˆ†é’Ÿå¤‡é½æ‰€æœ‰ææ–™

| éœ€å‡†å¤‡ | æ¨èæ–¹æ¡ˆ |
| :-- | :-- |
| é“¾ç«¯èŠ‚ç‚¹ | Infura Ropsten HTTPS ç»ˆç«¯ |
| è´¦æˆ·ç®¡ç† | MetaMaskï¼ˆRopsten æµ‹è¯•ç½‘ï¼‰ |
| æµ‹è¯•å¸ | åœ¨ MetaMask Buy â†’ â€œGet Etherâ€ é¢†å–ï¼Œæ¯æ¬¡ 1 ETHï¼Œæœ€å¤š 5 æ¬¡ |
| Python ç¯å¢ƒ | 3.8+ï¼Œpip install web3 |
| åˆçº¦ ABI | å·²éƒ¨ç½²æ‰¹é‡è½¬è´¦åˆçº¦ â€œStormMultisenderâ€ çš„æœ¬åœ°æ–‡ä»¶ |
| ç§é’¥ | MetaMask å¯¼å‡ºï¼Œå¦¥å–„ä¿å­˜ |

æç¤ºï¼šæ–‡ä¸­æ‰€æœ‰ç¤ºä¾‹å‡åŸºäº **ropsten.infura.io** æµ‹è¯•èŠ‚ç‚¹ï¼Œä¸ä¼šè§¦åŠä¸»ç½‘èµ„äº§ï¼Œå¯æ”¾å¿ƒåŠ¨æ‰‹ã€‚

ğŸ‘‰ [ç‚¹è¿™é‡ŒæŸ¥çœ‹ Ropsten æœ€æ–°åŒºå—é«˜åº¦ï¼ŒåŠ©ä½ åœ¨æµ‹è¯•ç½‘å¿«é€Ÿç¡®è®¤äº¤æ˜“çŠ¶æ€ã€‚](https://okxdog.com/)

---

## è¿è¡Œæ­¥éª¤ï¼š5 æ­¥å®Œæˆå…¨é“¾è·¯æµç¨‹

### 1. è·å–æ‰¹é‡è½¬è´¦åˆçº¦åœ°å€ä¸ ABI

- åœ°å€ï¼š`0xa5025faba6e70b84f74e9b1113e5f7f4e7f4859f`
- ABIï¼šå…‹éš† github.com/rstormsf/multisender â†’ è·å– `abis/StormMultisender.json`  
  è¯´æ˜ï¼šè¯¥åˆçº¦å·²éƒ¨ç½²è‡³ Ropstenï¼Œå¯ç›´æ¥è°ƒç”¨ `multisendEther` å‡½æ•°ã€‚

### 2. è´¦æˆ·ä½™é¢æ ¡éªŒ

```python
from web3 import Web3

web3 = Web3(Web3.HTTPProvider(
    "https://ropsten.infura.io/v3/YOUR_INFURA_PROJECT_ID"
))

how_much_wei = web3.eth.get_balance(from_address)
print(f"è´¦æˆ·ä½™é¢: {web3.fromWei(how_much_wei, 'ether')} ETH")
```

ä½™é¢å¿…é¡»å¤§äºï¼š**æ‰¹é‡è½¬è´¦æ€»é¢ + é¢„ä¼° gas è´¹ç”¨**ã€‚æµ‹è¯•é˜¶æ®µå¤šç»™ 10 %ï¼Œé¿å…äº¤æ˜“æ‰“åŒ…å¤±è´¥ã€‚

### 3. ç»„è£…å‚æ•°

å‡è®¾æˆ‘ä»¬è¦ç»™ä»¥ä¸‹ 2 ä¸ªåœ°å€åˆ†åˆ« **ä¸€æ¬¡æ€§** è½¬ 0.1 ETHï¼š

```python
addresses_to_send = [
    "0x5844de50Cf99F95ca073AC7B205f9C0C75E827A8",
    "0x8775039fCa840bde05519E4A743B2973F3C30B24"
]
values_wei = [web3.toWei(0.1, 'ether')] * 2
```

### 4. å»ºç«‹äº¤æ˜“ç»“æ„å¹¶é¢„ä¼° gas

```python
nonce = web3.eth.get_transaction_count(from_address)
transaction = Contract.functions.multisendEther(
    addresses_to_send,  # æ¥æ”¶åœ°å€ []
    values_wei          # å¯¹åº”é‡‘é¢ []
).buildTransaction({
    "from": from_address,
    "value": web3.toWei(sum(values_wei) + 0.01, 'ether'),  # ç¨å¾®å¤šè½¬ä¸€ç‚¹ï¼Œè¦†ç›– gas
    "gas": 0,  # å…ˆç”¨ estimate_gas è®¡ç®—
    "gasPrice": web3.toWei('20', 'gwei'),
    "nonce": nonce
})

# è‡ªåŠ¨ä¼°ç®— gas
transaction['gas'] = web3.eth.estimate_gas(transaction)
```

çœŸå®è„šæœ¬é‡Œå¯ç”¨ `estimate_gas` åŠ¨æ€è®¡ç®—ï¼Œé¿å…å†™æ­»ä¸Šé™ã€‚

### 5. ç­¾å + å¹¿æ’­

```python
signed = web3.eth.account.sign_transaction(transaction, private_key)
tx_hash = web3.eth.send_raw_transaction(signed.rawTransaction)
print(f"Tx Hash: {tx_hash.hex()}")
```

ç­‰å¾… 30 ç§’~2 åˆ†é’Ÿï¼Œåœ¨ [Ropsten Explorer](https://ropsten.etherscan.io) æœ tx hashï¼ŒçŠ¶æ€å˜ä¸º **Success** å³æ‰¹é‡è½¬è´¦ç”Ÿæ•ˆã€‚

---

## ä»£ç æ‰“åŒ…ï¼šç«‹å³å¯ç”¨è„šæœ¬ (main.py)

```python
"""EthBulkSender.py - åŸºäº web3py çš„æ‰¹é‡è½¬è´¦å·¥å…·"""

from web3 import Web3
from pathlib import Path
import json, os

INFURA_URL = "https://ropsten.infura.io/v3/{}".format(os.getenv("INFURA_KEY"))
FROM_ADDRESS = web3.toChecksumAddress("YOUR_ADDRESS")
PRIVATE_KEY = "YOUR_PRIVATE_KEY"
CONTRACT_ADDR = "0xa5025faba6e70b84f74e9b1113e5f7f4e7f4859f"
ABI_PATH = Path(__file__).parent / "abis" / "StormMultisender.json"

web3 = Web3(Web3.HTTPProvider(INFURA_URL))
with open(ABI_PATH, encoding='utf-8') as f:
    abi = json.load(f)
contract = web3.eth.contract(address=CONTRACT_ADDR, abi=abi)

def bulk_transfer_eth(targets, amounts):
    wei_amounts = [web3.toWei(i, "ether") for i in amounts]
    nonce = web3.eth.get_transaction_count(FROM_ADDRESS)
    payload = contract.functions.multisendEther(targets, wei_amounts).buildTransaction({
        "from": FROM_ADDRESS,
        "value": web3.toWei(sum(amounts) + 0.01, 'ether'),
        "gas": 0,
        "gasPrice": web3.toWei("20", "gwei"),
        "nonce": nonce
    })
    payload['gas'] = web3.eth.estimate_gas(payload)
    signed = web3.eth.account.sign_transaction(payload, PRIVATE_KEY)
    tx_hash = web3.eth.send_raw_transaction(signed.rawTransaction)
    return tx_hash.hex()

if __name__ == "__main__":
    # ç¤ºä¾‹ï¼šè½¬ 2 ä¸ªåœ°å€å„ 0.05 ETH
    recipients = ["0x...", "0x..."]
    amounts = [0.05, 0.05]
    print("Tx:", bulk_transfer_eth(recipients, amounts))
```

ä¿å­˜å `python EthBulkSender.py` å³å¯å‘èµ·è½¬è´¦ã€‚

---

## ä¸ºä»€ä¹ˆçœ gasï¼Ÿè€—æå¯¹æ¯”è¡¨æ ¼

æ¯æ¬¡å•ç¬”è½¬è´¦çº¦ `21,000` gasã€‚  
StormMultisender åˆçº¦æŠŠå¤šç¬”åŠ¨ä½œåˆå¹¶æˆ 1 æ¡äº¤æ˜“ï¼Œå®æµ‹ 2 æ¡åœ°å€æ—¶ï¼š`~44,400` å¯¹æ¯” `21,000 Ã— 2 = 42,000`ï¼Œå‡ ä¹æŒå¹³ï¼›ä½†å½“åœ°å€å¢è‡³ 10 æ¡æ—¶ï¼Œgas ä¸Šå‡ä¸º `~124,000`ï¼Œè¿œä½äº 10 ç¬”å•äº¤æ˜“æ€»å’Œ `210,000`ï¼Œ**èŠ‚èƒ½ 40 % ä»¥ä¸Š**ã€‚

---

## FAQï¼šå¤§å®¶æœ€å…³å¿ƒçš„é—®é¢˜

**Q1ï¼šä¸ºä»€ä¹ˆ `sendRawTransaction` æŠ¥çš„é”™æ˜¯ â€œalready knownâ€ï¼Ÿ**  
Aï¼šä¸Šä¸€ç¬”äº¤æ˜“ä»åœ¨æ‰“åŒ…æˆ–é˜Ÿåˆ—ä¸­ã€‚ç”¨ `web3.eth.get_transaction_receipt` æŸ¥è¯¢ `None`ï¼Œç­‰å…¶å®Œæˆå†å‘ä¸‹ä¸€ç¬”å³å¯ã€‚

**Q2ï¼šèƒ½æŠŠ ETH æ¢æˆ ERC-20 ä»£å¸å—ï¼Ÿ**  
Aï¼šå¯ä»¥ï¼ŒæŠŠ `multisendEther` æ¢æˆ `multisendToken` å¹¶åœ¨å‡½æ•°è°ƒç”¨é‡Œä¼ å…¥ tokenAddressï¼Œè„šæœ¬å…¶ä½™éƒ¨åˆ†ä¸å˜ã€‚

**Q3ï¼šåä¸‡å…ƒçº¢åŒ…çº§åˆ«çš„å¤§æ‰¹é‡è½¬è´¦å®‰å…¨å—ï¼Ÿ**  
Aï¼šå…ˆåœ¨æµ‹è¯•ç½‘å®Œæˆå…¨æµç¨‹éªŒè¯ï¼Œå†åˆ‡åˆ°ä¸»ç½‘ï¼Œå¹¶å‡çº§åˆ°ç§äººä¸“å±åˆçº¦ï¼ˆfork åä¿®æ”¹ ownerï¼‰ï¼Œé˜²æ­¢é»‘å®¢é’ˆå¯¹æ€§æ”»å‡»ã€‚

**Q4ï¼šæ€ä¹ˆä¼°ç®—ç²¾ç¡® gas è€Œä¸ç”¨æ­»å†™ 210000ï¼Ÿ**  
Aï¼šä½¿ç”¨ `web3.eth.estimate_gas` æˆ– `eth_estimateGas` RPC æ¥å£åŠ¨æ€è®¡ç®—ã€‚è„šæœ¬ç¤ºä¾‹å·²ç»™å‡ºã€‚

**Q5ï¼šæ‰¹é‡ä»˜æ¬¾æ—¶å‡ºç° â€œintrinsic gas too lowâ€ï¼Ÿ**  
Aï¼šä½ çš„ `buildTransaction` ä¸­ `value` é‡‘é¢ä¸è¶³çš„å†—ä½™ä½™é¢ï¼ŒåŠ ä¸Š 1 %â€“2 % æ‰‹ç»­è´¹å³å¯è§£å†³ã€‚

**Q6ï¼šèƒ½æŠŠè„šæœ¬æ”¹æˆæ¯æœˆå®šæ—¶ç‰ˆï¼Ÿ**  
Aï¼šç”¨ `APScheduler` åŠ é€šçŸ¥ä¸­å¿ƒï¼Œè®¾å®š cron å‘¨æœŸè§¦å‘ Python å‡½æ•°ï¼Œè®©ç³»ç»Ÿæ¯å¤©æˆ–æ¯å‘¨è‡ªåŠ¨è·‘ã€‚

---

## è¿›é˜¶å»¶ä¼¸ï¼šéƒ¨ç½²ä¸ªäººæ‰¹é‡è½¬è´¦åˆçº¦

å¦‚æœä½ æƒ³ 100 % æŒæ§å®‰å…¨ä¸ç‰ˆæœ¬ç®¡ç†ï¼Œå¯ç”¨ Multisender Flattened æºç ï¼š  
- æ–‡ä»¶ï¼š`UpgradebleStormSender_flat.sol`  
- IDEï¼šremix.ethereum.org  
- æ­¥éª¤ï¼šç¼–è¯‘ â†’ éƒ¨ç½² â†’ æŠŠæ–°åˆçº¦åœ°å€æ›¿æ¢æ‰è„šæœ¬ä¸­ `CONTRACT_ADDR` â†’ ç«‹å³ç‹¬äº«å‡çº§ä¸æƒé™æ§åˆ¶ã€‚

ğŸ‘‰ [æŒæ¡ç§é“¾éƒ¨ç½²ä¸å‚æ•°è°ƒä¼˜çš„ç»ˆææ‰‹å†Œç‚¹è¿™é‡Œï¼](https://okxdog.com/)

---

### æ€»ç»“

é€šè¿‡ 100 è¡Œä»¥å†… Python ä»£ç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿï¼š

- åœ¨çº¿å®Œæˆ **ä»¥å¤ªåŠæ‰¹é‡è½¬è´¦**ï¼›
- å®æµ‹å‡å°‘ 30 % ä»¥ä¸Š gasï¼›
- **web3py** ä¸Šæ‰‹é›¶é—¨æ§›ï¼Œé€‚åˆåç«¯å¼€å‘è€…ï¼›
- å…¼å®¹ä¸»ç½‘ä¸æµ‹è¯•ç½‘ï¼Œå…·å¤‡æå¼ºçš„ **å¯å¤ç”¨æ€§**ã€‚

å†™å¥½è„šæœ¬ï¼Œå‡ åˆ†é’Ÿå°±èƒ½å®ç°è¿‡å»å‡ å°æ—¶â€œä¸€æ¡ä¸€æ¡æ“ä½œâ€çš„å·¥ä½œé‡ã€‚ç°åœ¨ï¼ŒæŠŠæœ¬æ–‡å¤åˆ¶åˆ°ç”µè„‘ä¸Šï¼Œè£…ä¸Š web3pyï¼Œç«‹åˆ»è·‘èµ·æ¥ï¼